(function(a,b){if("function"==typeof define&&define.amd)define(["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.GamedockSDK=c.exports}})("undefined"==typeof globalThis?"undefined"==typeof self?this:self:globalThis,function(a){"use strict";var x=Math.floor;function b(a,b,c){if(!b.has(a))throw new TypeError("attempted to get private field on non-instance");return c}function c(a,b,c){if(a!==b)throw new TypeError("Private static access of wrong provenance");return c}function d(a){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},d(a)}function e(a,b){return b&&("object"===d(b)||"function"==typeof b)?b:f(a)}function f(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function g(a){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},g(a)}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&i(a,b)}function i(a,b){return i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},i(a,b)}function j(a,b){return m(a)||l(a,b)||k()}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function l(a,b){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function m(a){if(Array.isArray(a))return a}function n(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function o(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?n(Object(b),!0).forEach(function(c){w(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):n(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function p(a,b,c,d){if(a!==b)throw new TypeError("Private static access of wrong provenance");if(c.set)c.set.call(a,d);else{if(!c.writable)throw new TypeError("attempted to set read only private field");c.value=d}return d}function q(a,b,c){if(a!==b)throw new TypeError("Private static access of wrong provenance");return c.get?c.get.call(a):c.value}function r(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function s(a,b,c){return b&&r(a.prototype,b),c&&r(a,c),a}function t(a,b){var c=b.get(a);if(!c)throw new TypeError("attempted to get private field on non-instance");return c.get?c.get.call(a):c.value}function u(a,b,c){var d=b.get(a);if(!d)throw new TypeError("attempted to set private field on non-instance");if(d.set)d.set.call(a,c);else{if(!d.writable)throw new TypeError("attempted to set read only private field");d.value=c}return c}function v(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function w(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}Object.defineProperty(a,"__esModule",{value:!0}),a.initialize=function(a,b,c){ca.initialize(a,b,c)},a.Tracking=void 0;var y=function a(b){v(this,a),w(this,"rawData",null),this.rawData=b},z=/*#__PURE__*/function(){// TODO add the proper urls
function a(b){v(this,a),A.set(this,{writable:!0,value:null}),u(this,A,b)}return s(a,[{key:"url",value:function url(){return t(this,A)+"event/"}},{key:"send",value:function send(b){// console.log(`Sending event ${event.name} with params `, event.data);
var c=this.url()+b.name;return new Promise(function(d,e){var f=new XMLHttpRequest;f.open("POST",c,!0),f.onload=function(){if(4===f.readyState&&(200===f.status||204===f.status)){// console.log(`Event ${event.name} sent successfully, params:`, JSON.stringify(event.data));
var c=new y(f.responseText);d(c)}else e(a.error(b,f))}.bind(this),f.onerror=function(){e(a.error(b,f))}.bind(this),f.onabort=function(){e(a.error(b,f))},f.ontimeout=function(){e(a.error(b,f))},f.send(JSON.stringify(b.data))}.bind(this))}}],[{key:"error",value:function error(a,b){var c={},d=b.responseText;try{c=JSON.parse(b.responseText)}catch(a){console.log("Error response is not a json string")}finally{c.errors&&console.error("The request had an error",c.errors),c.details&&(d=c.details)}return Error("Event ".concat(a.name," failed to be sent with status ").concat(b.status," and reason \"").concat(d,"\""))}}]),a}(),A=new WeakMap,B=/*#__PURE__*/function(){function a(){v(this,a)}return s(a,null,[{key:"trackEvent",value:function trackEvent(b){return a.initialized?q(a,a,D).send(b):(console.warn("SDK was not initialized. Event tracking is disabled."),new Promise(function(a,b){return b(Error("SDK was not initialized. Event tracking is disabled."))}))}},{key:"initialize",value:function initialize(b){p(a,a,D,b),p(a,a,C,!0)}},{key:"CustomEvent",value:function CustomEvent(a,b){return new E(a,b)}},{key:"PageView",value:function PageView(a,b,c){return new I(a,b,c)}},{key:"FrameView",value:function FrameView(a,b,c){return new J(a,b,c)}},{key:"Gameplay",value:function Gameplay(a,b,c){return new K(a,b,c)}},{key:"initialized",get:function get(){return q(this,a,C)}/** @type DataSending     */}]),a}();a.Tracking=B;var C={writable:!0,value:!1},D={writable:!0,value:null},E=/*#__PURE__*/function(){function a(b,c){v(this,a),w(this,"name",""),F.set(this,{writable:!0,value:{}}),this.name=b,this.addCustomParameters(c)}return s(a,[{key:"data",/**  @type Visitor */get:function get(){return o({},this.computedData,{},q(a,a,H),{},t(this,F))}},{key:"computedData",get:function get(){return{visitorId:q(a,a,G).visitorId,timeOnPage:q(a,a,G).timeOnPage,sessionId:q(a,a,G).sessionId}}}]),s(a,[{key:"addCustomParameter",value:function addCustomParameter(a,b){return t(this,F)[a]=b,this}},{key:"addCustomParameters",value:function addCustomParameters(a){for(var b=0,c=Object.entries(a);b<c.length;b++){var d=j(c[b],2),e=d[0],f=d[1];t(this,F)[e]=f}return this}},{key:"track",value:function track(){return B.trackEvent(this)}}],[{key:"initialize",value:function initialize(b,c){p(this,a,G,b),q(this,a,H).domainId=c}}]),a}(),F=new WeakMap,G={writable:!0,value:null},H={writable:!0,value:{domainId:null}},I=/*#__PURE__*/function(a){function b(a,c,d){return v(this,b),e(this,g(b).call(this,"pageview",{pageId:a,pageType:c,isAuthorized:!!d}))}return h(b,a),b}(E),J=/*#__PURE__*/function(a){function b(a,c,d){return v(this,b),e(this,g(b).call(this,"frameview",{pageId:a,pageType:c,isAuthorized:!!d}))}return h(b,a),b}(E),K=/*#__PURE__*/function(a){function b(a,c,d){return v(this,b),e(this,g(b).call(this,"gameplay",{pageId:a,pageType:c,isAuthorized:!!d}))}return h(b,a),b}(E),L=/*#__PURE__*/function(){function a(){v(this,a)}return s(a,null,[{key:"makeSetterString",value:function makeSetterString(a,b,c,d,e,f,g){var h=Math.ceil,i="";if(c)switch(c.constructor){case Number:i=c===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:i="; expires="+c;break;case Date:i="; expires="+c.toUTCString();}return encodeURIComponent(a)+"="+encodeURIComponent(b)+i+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":"")+(!g||"no_restriction"===g.toString().toLowerCase()||0>g?"":"lax"===g.toString().toLowerCase()||1===h(g)||!0===g?"; samesite=lax":"; samesite=strict")}},{key:"getItem",value:function getItem(a){return a?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(this.reURIAllowed,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null}},{key:"setItem",value:function setItem(b,c,d,e,f,g,h){return b&&!this.reCNameAllowed.test(b)&&(document.cookie=a.makeSetterString(b,c,d,e,f,g,h),!0)}},{key:"removeItem",value:function removeItem(b,c,d,e,f){return!!this.hasItem(b)&&(document.cookie=a.makeSetterString(b,"","Thu, 01 Jan 1970 00:00:00 GMT",c,d,e,f),!0)}},{key:"hasItem",value:function hasItem(a){return a&&!this.reCNameAllowed.test(a)&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(this.reURIAllowed,"\\$&")+"\\s*\\=").test(document.cookie)}},{key:"keys",value:function keys(){for(var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=a.length,c=0;c<b;c++)a[c]=decodeURIComponent(a[c]);return a}},{key:"clear",value:function clear(a,b,c,d){for(var e=this.keys(),f=e.length,g=0;g<f;g++)this.removeItem(e[g],a,b,c,d)}}]),a}();w(L,"reURIAllowed",/[\-\.\+\*]/g),w(L,"reCNameAllowed",/^(?:expires|max\-age|path|domain|secure|samesite|httponly)$/i);var M=/*#__PURE__*/function(){function a(){v(this,a),W.add(this),V.add(this),U.add(this),T.add(this),N.set(this,{writable:!0,value:null}),O.set(this,{writable:!0,value:null}),P.set(this,{writable:!0,value:null}),Q.set(this,{writable:!0,value:null}),R.set(this,{writable:!0,value:null}),S.set(this,{writable:!0,value:0});var d=L.getItem(q(this.constructor,a,Y)),e=!1;try{d=JSON.parse(d)||{}}catch(a){d={}}if(!d.hasOwnProperty("visitorId")){var f;d.visitorId=c(f=this.constructor,a,X).call(f)}if(d.hasOwnProperty("sessionEnd")&&(e=Date.now()-d.sessionEnd>q(this.constructor,a,Z)),d.hasOwnProperty("sessionStart")||(d.sessionStart=Date.now()),!d.hasOwnProperty("sessionId")||e){var g;d.sessionId=c(g=this.constructor,a,X).call(g),d.sessionStart=Date.now()}u(this,N,d.visitorId),u(this,O,d.sessionId),u(this,P,d.sessionStart),u(this,R,Date.now()),b(this,T,$).call(this),window.addEventListener("beforeunload",function(){u(this,Q,Date.now()),b(this,T,$).call(this)}.bind(this)),document.addEventListener("visibilitychange",b(this,W,ba).bind(this),!1)}return s(a,[{key:"toString",value:function toString(){return JSON.stringify({visitorId:t(this,N),sessionId:t(this,O),sessionStart:t(this,P),sessionEnd:t(this,Q)})}},{key:"visitorId",// 30 minutes
get:function get(){return t(this,N)}},{key:"sessionId",get:function get(){return t(this,O)}},{key:"sessionStart",get:function get(){return t(this,P)}},{key:"timeOnPage",get:function get(){return x((t(this,S)+(Date.now()-t(this,R)))/1e3)}}]),a}(),N=new WeakMap,O=new WeakMap,P=new WeakMap,Q=new WeakMap,R=new WeakMap,S=new WeakMap,T=new WeakSet,U=new WeakSet,V=new WeakSet,W=new WeakSet,X=function(){var a=new Date().getTime(),b=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var c=16*Math.random();return 0<a?(c=0|(a+c)%16,a=x(a/16)):(c=0|(b+c)%16,b=x(b/16)),("x"===d?c:8|3&c).toString(16)})},Y={writable:!0,value:"_gdwt"},Z={writable:!0,value:1800000},$=function(){L.setItem(q(this.constructor,M,Y),this.toString())},_=function(){u(this,S,t(this,S)+(Date.now()-t(this,R)))},aa=function(){u(this,R,Date.now())},ba=function(){document.hidden?b(this,U,_).call(this):b(this,V,aa).call(this)},ca=/*#__PURE__*/function(){function a(){v(this,a)}return s(a,null,[{key:"initialize",/** @type Visitor */ /**
     *
     * @param orgId String the Organization id
     * @param domainId String The domain Id
     * @param environment ('STG'|'PRD') The environment
     */value:function initialize(b,c,d){p(this,a,fa,new M),q(this,a,ea).orgId=b,q(this,a,ea).domainId=c,q(this,a,ea).environment=d?d:"PRD",p(this,a,da,!0),E.initialize(q(this,a,fa),c),B.initialize(new z(this.urls[q(this,a,ea).environment]+q(this,a,ea).orgId+"/")),this.Tracking=B}}]),a}(),da={writable:!0,value:!1},ea={writable:!0,value:{}},fa={writable:!0,value:null};w(ca,"Tracking",B),w(ca,"urls",{STG:"https://tracker-stg.gamedock.io/v1/events-tracker/track/",PRD:"https://tracker.gamedock.io/v1/events-tracker/track/"})});

//# sourceMappingURL=gamedock-sdk.min.js.map